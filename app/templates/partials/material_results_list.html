{% if materials %}
<div class="overflow-x-auto rounded-lg border border-slate-200">
    <table class="min-w-full divide-y divide-slate-200">
        <thead class="bg-slate-50">
            <tr>
                <th class="py-3 pl-4 text-left text-xs font-bold uppercase text-slate-500">Produttore</th>
                <th class="px-3 py-3 text-left text-xs font-bold uppercase text-slate-500">Materiale</th>
                <th class="px-3 py-3 text-left text-xs font-bold uppercase text-slate-500">Stato EPD</th>
                <th class="px-3 py-3 text-right text-xs font-bold uppercase text-slate-500">Azioni</th>
            </tr>
        </thead>
        <tbody class="divide-y divide-slate-100 bg-white">
            {% for mat in materials %}
            <tr class="hover:bg-slate-50 transition-colors">
                <td class="whitespace-nowrap py-4 pl-4 text-sm font-medium text-brand-600">
                    {{ mat.companies.name }}
                </td>

                <td class="px-3 py-4 text-sm text-slate-500">
                    <div class="font-bold text-slate-900">{{ mat.name }}</div>
                    <div class="text-xs text-slate-400 mt-1 max-w-xs truncate">{{ mat.category }}</div>
                </td>

                <td class="whitespace-nowrap px-3 py-4 text-sm text-slate-500">
                    {% if mat.epd_url or mat.epd_file_path %}
                        <span class="inline-flex items-center rounded-md bg-green-50 px-2 py-1 text-xs font-medium text-green-700 border border-green-200">
                            <i class="fa-solid fa-check-circle mr-1"></i> EPD Presente
                        </span>
                        {% if mat.epd_file_path %}
                        <a href="{{ mat.epd_file_path }}" target="_blank" class="text-xs text-blue-500 hover:underline ml-1">(File)</a>
                        {% elif mat.epd_url %}
                        <a href="{{ mat.epd_url }}" target="_blank" class="text-xs text-blue-500 hover:underline ml-1">(Link)</a>
                        {% endif %}
                    {% else %}
                        <span class="inline-flex items-center rounded-md bg-slate-100 px-2 py-1 text-xs font-medium text-slate-500 border border-slate-200">
                            Mancante
                        </span>
                    {% endif %}
                </td>

                <td class="whitespace-nowrap px-3 py-4 text-sm text-right pr-4">
                    <button
                        class="bg-white text-brand-600 border border-brand-200 hover:bg-brand-50 hover:border-brand-300 px-4 py-1.5 rounded-lg transition-all text-xs font-bold shadow-sm"
                        hx-post="/projects/{{ active_project_id }}/credits/mr_epd/assign"
                        hx-vals='{"material_id": "{{ mat.id }}"}'>
                        <i class="fa-solid fa-plus mr-1"></i> Aggiungi
                    </button>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% else %}
<div class="p-8 text-center bg-white rounded-xl border border-dashed border-slate-300 mt-4">
    <div class="text-slate-300 text-4xl mb-3"><i class="fa-solid fa-box-open"></i></div>
    <h3 class="text-sm font-bold text-slate-600">Nessun materiale trovato</h3>
    <p class="text-xs text-slate-400 mt-1">Prova a cambiare i filtri o cerca un altro termine.</p>
</div>
{% endif %}
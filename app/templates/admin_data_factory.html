{% extends "base.html" %}

{% block content %}
<div class="grid grid-cols-1 lg:grid-cols-2 gap-8">

    <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
        <h2 class="text-xl font-bold text-slate-800 mb-4"><i class="fa-solid fa-robot mr-2"></i> Data Factory Ingestion</h2>
        <p class="text-sm text-slate-500 mb-4">Incolla la lista CSV: <code>Produttore, Nome Prodotto, URL</code></p>
        
        <form hx-post="/admin/data-factory/process" hx-target="#log-area" hx-indicator="#loading">
            <textarea name="raw_list" rows="10" 
                class="w-full p-4 bg-slate-900 text-green-400 font-mono text-xs rounded-lg mb-4"
                placeholder="Mapei, Planitop Fast 330, https://mapei.com/...\nRockwool, Frontrock Max, https://rockwool.com/..."></textarea>
            
            <button type="submit" class="w-full bg-brand-600 text-white font-bold py-3 rounded-lg hover:bg-brand-700">
                Avvia Motore AI
            </button>
        </form>

        <div id="loading" class="htmx-indicator mt-4 text-center text-slate-500">
            <i class="fa-solid fa-circle-notch fa-spin"></i> Elaborazione in corso...
        </div>
        
        <div id="log-area" class="mt-4"></div>
    </div>

    <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
        <h2 class="text-xl font-bold text-slate-800 mb-4">Bozze da Validare</h2>
        
        <div class="overflow-y-auto max-h-[600px] space-y-3">
            {% for d in drafts %}
            <div class="p-4 border border-slate-100 rounded-lg hover:border-brand-500 transition-colors bg-slate-50">
                <div class="flex justify-between items-start">
                    <div>
                        <div class="text-xs font-bold text-slate-400 uppercase">{{ d.companies.name }}</div>
                        <div class="font-bold text-slate-800">{{ d.name }}</div>
                        <div class="text-xs text-slate-500 mt-1">{{ d.category }}</div>
                    </div>
                    <div class="text-right">
                        <button hx-post="/admin/validate-product/{{ d.id }}" hx-swap="outerHTML"
                            class="bg-green-100 text-green-700 px-3 py-1 rounded text-xs font-bold hover:bg-green-200">
                            Valida
                        </button>
                        <a href="{{ d.url_technical_sheet }}" target="_blank" class="block mt-2 text-xs text-blue-500 underline">Link</a>
                    </div>
                </div>
                <div class="mt-2 text-xs text-slate-400 font-mono truncate">
                    {{ d.properties }}
                </div>
            </div>
            {% endfor %}
        </div>
    </div>

</div>
{% endblock %}
<div class="overflow-hidden bg-white shadow-sm ring-1 ring-slate-900/5 rounded-xl">
    {% if materials %}
    <table class="min-w-full divide-y divide-slate-200">
        <thead class="bg-slate-50">
            <tr>
                <th scope="col" class="py-3.5 pl-4 pr-3 text-left text-xs font-bold uppercase tracking-wide text-slate-500 sm:pl-6">Prodotto</th>
                <th scope="col" class="px-3 py-3.5 text-left text-xs font-bold uppercase tracking-wide text-slate-500">Produttore</th>
                <th scope="col" class="relative py-3.5 pl-3 pr-4 sm:pr-6">
                    <span class="sr-only">Azioni</span>
                </th>
            </tr>
        </thead>
        <tbody class="divide-y divide-slate-100 bg-white">
            {% for mat in materials %}
            <tr class="hover:bg-slate-50 transition-colors group">
                <td class="whitespace-nowrap py-4 pl-4 pr-3 text-sm sm:pl-6">
                    <div class="flex items-center">
                        <div class="h-10 w-10 flex-shrink-0 rounded-full bg-green-50 flex items-center justify-center text-green-600 border border-green-100">
                            <i class="fa-solid fa-leaf"></i>
                        </div>
                        <div class="ml-4">
                            <div class="font-bold text-slate-900">{{ mat.name }}</div>
                            <div class="text-xs text-slate-500 mb-1">{{ mat.category or 'N.D.' }}</div>
                            
                            {% if mat.epd_type %}
                            <div class="inline-flex items-center rounded-md bg-blue-50 px-2 py-1 text-xs font-medium text-blue-700 ring-1 ring-inset ring-blue-700/10 mt-1">
                                <i class="fa-solid fa-certificate mr-1.5 opacity-70"></i>
                                {{ mat.epd_type }}
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </td>
                
                <td class="whitespace-nowrap px-3 py-4 text-sm text-slate-500">
                    <div class="flex items-center">
                        <i class="fa-regular fa-building mr-2 text-slate-400"></i>
                        <span class="font-medium">{{ mat.companies.name }}</span>
                    </div>
                </td>

                <td class="whitespace-nowrap px-3 py-4 text-sm text-right pr-4">
                    <button
                        type="button"
                        class="bg-white text-brand-600 border border-brand-200 hover:bg-brand-50 hover:border-brand-300 px-4 py-1.5 rounded-lg transition-all text-xs font-bold shadow-sm flex items-center ml-auto"
                        
                        {# 1. Manda la richiesta al server #}
                        hx-post="/projects/{{ active_project_id }}/credits/mr_epd/assign"
                        hx-vals='{"material_id": "{{ mat.id }}"}'
                        
                        {# 2. Aggiorna la colonna di DESTRA (La lista degli assegnati) #}
                        hx-target="#project-materials-container" 
                        hx-swap="innerHTML"
                        
                        {# 3. Rimuove la riga corrente (SINISTRA) dopo il successo #}
                        hx-on:htmx:after-request="if(event.detail.successful) this.closest('tr').remove()">
                        
                        <i class="fa-solid fa-plus mr-1"></i> Aggiungi
                    </button>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <div class="text-center py-12">
        <div class="inline-flex items-center justify-center w-12 h-12 rounded-full bg-slate-100 mb-4">
            <i class="fa-solid fa-magnifying-glass text-slate-400 text-lg"></i>
        </div>
        <h3 class="mt-2 text-sm font-semibold text-slate-900">Nessun materiale trovato</h3>
        <p class="mt-1 text-sm text-slate-500">Prova a modificare i filtri o i termini di ricerca.</p>
    </div>
    {% endif %}
</div>
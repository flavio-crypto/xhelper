{% if materials %}
<div class="overflow-x-auto">
    <table class="min-w-full divide-y divide-slate-300">
        <thead class="bg-slate-50">
            <tr>
                <th scope="col" class="py-3.5 pl-4 pr-3 text-left text-sm font-semibold text-slate-900 sm:pl-6">
                    Produttore</th>
                <th scope="col" class="px-3 py-3.5 text-left text-sm font-semibold text-slate-900">Materiale</th>
                <th scope="col" class="px-3 py-3.5 text-left text-sm font-semibold text-slate-900">Categoria</th>
                <th scope="col" class="px-3 py-3.5 text-left text-sm font-semibold text-slate-900">Stato EPD</th>
                <th scope="col" class="px-3 py-3.5 text-left text-sm font-semibold text-slate-900">Azioni</th>
            </tr>
        </thead>
        <tbody class="divide-y divide-slate-200 bg-white">
            {% for mat in materials %}
            <tr class="hover:bg-slate-50 transition-colors">
                <td class="whitespace-nowrap py-4 pl-4 pr-3 text-sm font-medium text-brand-600 sm:pl-6">
                    {{ mat.manufacturers.name }}
                </td>

                <td class="px-3 py-4 text-sm text-slate-500">
                    <div class="font-bold text-slate-900">{{ mat.name }}</div>
                    <div class="text-xs text-slate-400 mt-1 max-w-xs truncate" title="{{ mat.description }}">
                        {{ mat.description }}
                    </div>
                </td>

                <td class="whitespace-nowrap px-3 py-4 text-sm text-slate-500">
                    <span
                        class="inline-flex items-center rounded-md bg-slate-100 px-2 py-1 text-xs font-medium text-slate-600 ring-1 ring-inset ring-slate-500/10">
                        {{ mat.category }}
                    </span>
                </td>

                <td class="whitespace-nowrap px-3 py-4 text-sm text-slate-500">
                    {% if mat.epds and mat.epds|length > 0 %}
                    {% set epd = mat.epds[0] %}

                    {% if epd.epd_type == 3 %}
                    <span
                        class="inline-flex items-center rounded-md bg-green-50 px-2 py-1 text-xs font-medium text-green-700 ring-1 ring-inset ring-green-600/20">
                        <i class="fa-solid fa-check-circle mr-1"></i> Tipo III
                    </span>
                    {% elif epd.epd_type == 2 %}
                    <span
                        class="inline-flex items-center rounded-md bg-yellow-50 px-2 py-1 text-xs font-medium text-yellow-800 ring-1 ring-inset ring-yellow-600/20">
                        <i class="fa-solid fa-triangle-exclamation mr-1"></i> Tipo II
                    </span>
                    {% else %}
                    <span
                        class="inline-flex items-center rounded-md bg-blue-50 px-2 py-1 text-xs font-medium text-blue-700 ring-1 ring-inset ring-blue-700/10">
                        Tipo I
                    </span>
                    {% endif %}

                    {% if epd.url_external %}
                    <a href="{{ epd.url_external }}" target="_blank"
                        class="text-xs text-brand-600 hover:text-brand-800 ml-2 underline">
                        PDF
                    </a>
                    {% endif %}
                    {% else %}
                    <span
                        class="inline-flex items-center rounded-md bg-red-50 px-2 py-1 text-xs font-medium text-red-700 ring-1 ring-inset ring-red-600/10">
                        Nessuna EPD
                    </span>
                    {% endif %}
                </td>

                <td class="whitespace-nowrap px-3 py-4 text-sm text-slate-500">
                    <button
                        class="text-brand-600 hover:text-brand-900 border border-brand-200 hover:bg-brand-50 px-3 py-1.5 rounded-lg transition-all text-xs font-semibold"
                        hx-post="/projects/{{ active_project.id }}/credits/mr_epd/assign"
                        hx-vals='{"material_id": "{{ mat.id }}", "epd_id": "{{ mat.epds[0].id if mat.epds else "" }}"}'>
                        + Aggiungi
                    </button>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% else %}
<div class="p-8 text-center bg-yellow-50 rounded-lg m-4 border border-yellow-100">
    <i class="fa-solid fa-search-minus text-yellow-400 text-3xl mb-3"></i>
    <h3 class="text-sm font-medium text-yellow-800">Nessun materiale trovato</h3>
    <p class="mt-1 text-sm text-yellow-700">Prova a modificare i filtri o cerca una parola chiave diversa.</p>
</div>
{% endif %}